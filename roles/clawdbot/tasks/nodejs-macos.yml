---
# macOS-specific Node.js installation (Homebrew)

- name: Install Node.js via Homebrew (macOS)
  community.general.homebrew:
    name: node
    state: present
  environment:
    PATH: "/opt/homebrew/bin:{{ ansible_env.PATH }}"

- name: Install pnpm globally
  ansible.builtin.command: npm install -g pnpm
  args:
    creates: /opt/homebrew/bin/pnpm
  environment:
    PATH: "/opt/homebrew/bin:{{ ansible_env.PATH }}"

- name: Verify Node.js installation
  ansible.builtin.command: node --version
  register: node_version
  changed_when: false
  environment:
    PATH: "/opt/homebrew/bin:{{ ansible_env.PATH }}"

- name: Verify pnpm installation
  ansible.builtin.command: pnpm --version
  register: pnpm_version
  changed_when: false
  environment:
    PATH: "/opt/homebrew/bin:{{ ansible_env.PATH }}"

- name: Display Node.js and pnpm versions
  ansible.builtin.debug:
    msg:
      - "Node.js version: {{ node_version.stdout }}"
      - "pnpm version: {{ pnpm_version.stdout }}"